# 3DSSF - 1st assignment

This repository contains different algorithms about stereo vision matching, displaying and analysing. In particular C++ implementation contains features like:

 - Reading and saving images using OpenCV,
 - Disparity image generated by naive stereo matching using SSD technique,
 - Disparity image generated by dynamic programming approach,
 - Different metrics (SSD, SSIM, Peak signal to noise ratio),
 - Pointcloud generator for disparity images and writer to .ply file,

All 6 stereo pair images were taken from [Middlebury stereo datasets](http://vision.middlebury.edu/stereo/data) together with ground truth image provided in the package.
Different parameters (in pointcloud generator) were taken from Middlebury as well. *(_3740px_ and _160mm_ for the focal length and the baseline).*

# How to run the code
In order to run the code you must generate binary file using cmake. CMakeLists.txt is provided in the repository. 

Beside that to run the code user has to have OpenCV library for C++.

# Results
Below you can find results for different Middlebury stereo pairs. All of the images, 3d models and other information can be found in the data folder (for each set seperately).

If the images are not showing up please contact me through github. (it is possible that the host of the images deleted them)

## Stereo pairs

6 different stereo pair images presented below were used for my analysis. These images differ in size, therefore it will be visible in the analysis that some disparity images are calculated much faster than the others.

For each disparity image .ply file was generated and then visualized in Meshlab software. Screenshots of these 3d models can be found below. .ply files can be found in this repository as well.

For all images 3 disparity images were created:

 - **SSD**(patch_size = 2, disparity = 4)
 - **SSD**(patch_size = 12, disparity = 14)
 - **DP**(occlusion = 18)

The reason for using same parameters in all cases is to show that there is are no gold parameters that will work with all images. Each image has to be taken individually and therefore some results might not be satisfactory.

![Image stereo pairs](https://i.ibb.co/nQXkm3p/combine-images.jpg)
## Image set 1 - Art

![Side by side comparison](https://i.ibb.co/dbVJqKN/Combined-images.jpg)

Image size: 1390x1110
Statistics for each algorithm:
| Algorihm | Time | Signal to Noise ratio | SSIM Index |
|--|--|--|--|
| SSD(2,4) | <1second | 28,24 | 6417 |
| SSD(12,14) | 15 seconds | 26,15 | 7287 |
| DP(18) | 76 seconds | 33,89 | 6210 |

Pointcloud 3d model:
![3D pointcloud model](https://i.ibb.co/JrxmHzT/img.png)
**Conclusion**
In case of "Art" stereo pair dynamic programming creates much more comprehensive disparity image than in case of SSD. The disadvantage of that is that DP costs more time. In terms of scores all of the images are more or less the same.

## Image set 2 - Masks
![Side by side comparison of the results](https://i.ibb.co/hK9tgmK/combine-images.jpg)

Image size: 450x375
Statistics for each algorithm:
| Algorihm | Time | Signal to Noise ratio | SSIM Index |
|--|--|--|--|
| SSD(2,4) | <1second | ~0 | 51 |
| SSD(12,14) | 1 second | ~0 | 92 |
| DP(18) | 2 seconds | ~0 | 184 |

Pointcloud 3d model:
![3D Pointcloud model](https://i.ibb.co/2KmKfrt/img.png)
**Conclusion**
In case of "Mask" stereo pair dynamic programming creates much more comprehensive disparity image than in case of SSD, here to solve the problem of SSDs results it would be nice to tweak a little bit the parameters.

## Image set 3 - Toys
![Side by side comparison](https://i.ibb.co/KwR64X0/combine-images.jpg)

Image size: 450x375
Statistics for each algorithm:
| Algorihm | Time | Signal to Noise ratio | SSIM Index |
|--|--|--|--|
| SSD(2,4) | <1second | ~0 | 0 |
| SSD(12,14) | 1 second | ~0 | 0 |
| DP(18) | 2 seconds | ~0 | 0 |

Pointcloud 3d model:
![3D Pointcloud model](https://i.ibb.co/JrF1ZK0/img.png)
**Conclusion**
In case of "Toys" stereo pair dynamic programming creates much more comprehensive disparity image than in case of SSD, here to solve the problem of SSDs results it would be nice to tweak a little bit the parameters just as in previous pair. What's more it seems that for small size images the Signal to Noise ratio and SSIM Index show meaningless information.

## Image set 4 - Plant

![Side by side comparison](https://i.ibb.co/SKV87DY/combine-images.jpg)
Image size: 1282x1110
Statistics for each algorithm:
| Algorihm | Time | Signal to Noise ratio | SSIM Index |
|--|--|--|--|
| SSD(2,4) | <1second | ~0 | 1180 |
| SSD(12,14) | 14 seconds | ~0 | 193 |
| DP(18) | 67 secondss | ~0 | 615 |

Pointcloud 3d model:
![3D Pointcloud model](https://i.ibb.co/pX1DBnk/img.png)**Conclusion**
Seems that with "easier" shapes or rather single objects on the image, naive SSD works better than in case of more complicated images (i.e. SSIM score for SSD is better than for DP)

## Image set 5 - Bowl
![Side by side comparison](https://i.ibb.co/PthTKK1/combine-images.jpg)
Image size: 1252x1110
Statistics for each algorithm:
| Algorihm | Time | Signal to Noise ratio | SSIM Index |
|--|--|--|--|
| SSD(2,4) | <1second | 22,34 | 346 |
| SSD(12,14) | 14 seconds | 26,12 | 95 |
| DP(18) | 64 seconds | 18,09 | 193 |

Pointcloud 3d model:
![3D Pointcloud model](https://i.ibb.co/jrXRbKm/img.png)
**Conclusion**
Here once again Naive algorithm shows quite nice results with good score and disparity image.

## Image set 6 - Bowl
![Side by side comparison](https://i.ibb.co/dKVbGzm/combine-images.jpg)

Image size: 1312x1110
Statistics for each algorithm:
| Algorihm | Time | Signal to Noise ratio | SSIM Index |
|--|--|--|--|
| SSD(2,4) | <1second | 22,34 | 19 |
| SSD(12,14) | 15 seconds | 26,12 | 7 |
| DP(18) | 71 seconds | 18,09 | 4294967326 |

Pointcloud 3d model:

![3D Pointcloud model](https://i.ibb.co/rQvB9k4/img.png)
**Conclusion**
Case of pots is quite unusual because for DP algo, we can see that the SSIM score is super high. However (I did not check that), I think it is because of some memory issue in the code.

## General conclusions

Some general conclusion that I can see after analysing these 6 sets.

 1. Dynamic Programming approach creates more comprehensive disparity images (especially on complex images). However it does this with cost of time. Usually DP was couple times longer than naive approach.
 2. Naive SSD creates great results for simple pairs but it has to be well parametrized. Much more than DP approach.
 3. There are possible improvements that can be done. I.e. OpenMP library could be used to boost the time cost of the algortihms.
 4. The total time of analysing these 6 stereo pairs was **392 seconds**.
 5. Generating 3D pointcloud can be improved for sure (with tweaking the camera parameters) but I think mine results are quite satisfactory.
 6. Bigger images (greater size) takes much more time to compute than smaller images.
